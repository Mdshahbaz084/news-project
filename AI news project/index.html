<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI News Aggregator</title>
    <link rel="stylesheet" href="style.css">
    <!-- <script src="script.js"></script> -->
</head>
<body>

    <div class="container">
        <h2>📰 AI-Powered News Aggregator</h2>

        <div class="controls">
            <button id="dark-mode-toggle">🌙 Dark Mode</button>
            <input type="text" id="search-input" placeholder="Search News...">
            <button onclick="searchNews()">🔍 Search</button>
            <button onclick="startVoiceSearch()">🎤 Voice Search</button>
        </div>

        <div class="filters">
            <select id="category">
                <option value="technology">Technology</option>
                <option value="business">Business</option>
                <option value="sports">Sports</option>
                <option value="health">Health</option>
            </select>

            <select id="sort">
                <option value="publishedAt">Latest</option>
                <option value="popularity">Most Popular</option>
                <option value="relevancy">Relevant</option>
            </select>

            <button onclick="fetchNews(true)">🔄 Refresh</button>
        </div>

        <div id="loading">Loading...</div>
        <div id="news-container"></div>
    </div>

    <script>

// const apiKey = "2f243b84e5ed4d1987ea28b037281c85"; // Yahan apna API key daalein
// const url = `https://newsapi.org/v2/top-headlines?country=in&apiKey=${apiKey}`;

// fetch(url)
//     .then(response => response.json())
//     .then(data => console.log(data.articles))
//     .catch(error => console.error("Error fetching news:", error));


const apiKey = "2f243b84e5ed4d1987ea28b037281c85"; // Replace with your API key
const newsContainer = document.getElementById("news-container");
const categorySelect = document.getElementById("category");
const sortSelect = document.getElementById("sort");
const loading = document.getElementById("loading");

let page = 1;
let lastCategory = localStorage.getItem("lastCategory") || "technology";
let lastSort = localStorage.getItem("lastSort") || "publishedAt";

categorySelect.value = lastCategory;
sortSelect.value = lastSort;

// Dark Mode Toggle
const darkModeToggle = document.getElementById("dark-mode-toggle");
if (localStorage.getItem("darkMode") === "enabled") {
    document.body.classList.add("dark-mode");
}

darkModeToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", document.body.classList.contains("dark-mode") ? "enabled" : "disabled");
});

// Fetch News Function
async function fetchNews(reset = false) {
    if (reset) {
        newsContainer.innerHTML = "";
        page = 1;
    }

    const category = categorySelect.value;
    const sortBy = sortSelect.value;
    const url = `https://newsapi.org/v2/top-headlines?country=in&category=${category}&sortBy=${sortBy}&page=${page}&apiKey=${apiKey}`;

    loading.style.display = "block";
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        displayNews(data.articles);
        page++;

        localStorage.setItem("lastCategory", category);
        localStorage.setItem("lastSort", sortBy);
    } catch (error) {
        console.error("Error fetching news:", error);
    } finally {
        loading.style.display = "none";
    }
}

// Display News
function displayNews(articles) {
    articles.forEach(article => {
        const newsItem = document.createElement("div");
        newsItem.classList.add("news-item");
        newsItem.innerHTML = `
            <img src="${article.urlToImage}" alt="News Image">
            <div>
                <h3>${article.title}</h3>
                <p>${article.description}</p>
                <a href="${article.url}" target="_blank">Read More</a>
            </div>
        `;
        newsContainer.appendChild(newsItem);
    });
}

// Infinite Scroll
window.addEventListener("scroll", () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
        fetchNews();
    }
});

// Search News
async function searchNews() {
    const query = document.getElementById("search-input").value;
    const url = `https://newsapi.org/v2/everything?q=${query}&apiKey=${apiKey}`;

    newsContainer.innerHTML = "";
    loading.style.display = "block";

    try {
        const response = await fetch(url);
        const data = await response.json();
        displayNews(data.articles);
    } catch (error) {
        console.error("Error fetching search news:", error);
    } finally {
        loading.style.display = "none";
    }
}

// Voice Search
function startVoiceSearch() {
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "en-US";

    recognition.onresult = (event) => {
        const spokenText = event.results[0][0].transcript;
        document.getElementById("search-input").value = spokenText;
        searchNews();
    };

    recognition.start();
}

// Load News on Start
fetchNews(true);
    </script>
</body>
</html>